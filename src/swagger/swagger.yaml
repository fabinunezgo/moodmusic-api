openapi: 3.0.0
info:
  title: MoodMusic API
  version: 1.0.0
  description: API para sugerir canciones según emoción, administrar playlists y manejar usuarios.

servers:
  - url: http://localhost:3000

tags:
  - name: Autenticación
  - name: Usuarios
  - name: Roles
  - name: Emociones
  - name: Canciones
  - name: Playlists
  - name: Playlist-Canciones

paths:
  #  AUTENTICACIÓN
  /api/auth/register:
    post:
      tags: [Autenticación]
      summary: Registrar usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Register"
      responses:
        201:
          description: Usuario registrado correctamente
        400:
          description: Error de validación

  /api/auth/login:
    post:
      tags: [Autenticación]
      summary: Iniciar sesión
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Login"
      responses:
        200:
          description: Sesión iniciada
        401:
          description: Credenciales incorrectas

  #  USUARIOS
  /api/users:
    get:
      tags: [Usuarios]
      summary: Obtener todos los usuarios (solo admin)
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de usuarios
    post:
      tags: [Usuarios]
      summary: Crear usuario (solo admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses:
        201:
          description: Usuario creado

  /api/users/{id}:
    get:
      tags: [Usuarios]
      summary: Obtener usuario por ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Usuario encontrado
        404:
          description: Usuario no encontrado
    put:
      tags: [Usuarios]
      summary: Actualizar usuario
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdate"
      responses:
        200:
          description: Usuario actualizado
    delete:
      tags: [Usuarios]
      summary: Eliminar usuario
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Usuario eliminado

  #  ROLES
  /api/roles:
    get:
      tags: [Roles]
      summary: Obtener roles
      responses:
        200:
          description: Lista de roles
    post:
      tags: [Roles]
      summary: Crear rol
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Rol"
      responses:
        201:
          description: Rol creado

  #  EMOCIONES
  /api/emociones:
    get:
      tags: [Emociones]
      summary: Obtener emociones
      responses:
        200:
          description: Lista de emociones
    post:
      tags: [Emociones]
      summary: Crear emoción
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Emocion"
      responses:
        201:
          description: Emoción creada

  #  CANCIONES
  /api/canciones:
    get:
      tags: [Canciones]
      summary: Obtener canciones filtradas por emoción
      parameters:
        - in: query
          name: emocion
          schema:
            type: string
      responses:
        200:
          description: Lista de canciones
    post:
      tags: [Canciones]
      summary: Crear canción (admin)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Cancion"
      responses:
        201:
          description: Canción creada

  #  PLAYLISTS (rutas reales)
  /api/playlist:
    get:
      tags: [Playlists]
      summary: Obtener playlists del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de playlists
    post:
      tags: [Playlists]
      summary: Crear playlist
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Playlist"
      responses:
        201:
          description: Playlist creada

  /api/playlist/{id}:
    delete:
      tags: [Playlists]
      summary: Eliminar playlist
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Playlist eliminada

  #  PLAYLIST-CANCIONES (rutas reales)
  /api/playlistCancion:
    post:
      tags: [Playlist-Canciones]
      summary: Agregar canción a playlist
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlaylistCancion"
      responses:
        201:
          description: Canción agregada a playlist

  /api/playlistCancion/{id}:
    delete:
      tags: [Playlist-Canciones]
      summary: Quitar canción de playlist
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Canción eliminada de playlist

# SCHEMAS
components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    Register:
      type: object
      required: [nombre, email, password]
      properties:
        nombre: { type: string }
        email: { type: string }
        password: { type: string }

    Login:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

    User:
      type: object
      properties:
        nombre: { type: string }
        email: { type: string }
        password: { type: string }
        rol_id: { type: integer }

    UserUpdate:
      type: object
      properties:
        nombre: { type: string }
        email: { type: string }
        password: { type: string }
        rol_id: { type: integer }

    Rol:
      type: object
      properties:
        nombre: { type: string }

    Emocion:
      type: object
      properties:
        nombre: { type: string }

    Cancion:
      type: object
      properties:
        titulo: { type: string }
        artista: { type: string }
        emocion_id: { type: integer }

    Playlist:
      type: object
      properties:
        nombre: { type: string }

    PlaylistCancion:
      type: object
      properties:
        playlist_id: { type: integer }
        cancion_id: { type: integer }
